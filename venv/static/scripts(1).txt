// let items = ['abc', 'cde'];
let checkItems = ['a', 'b', 'c'];

$( document ).ready(function() {

    $.get("http://127.0.0.1:8000/files", function(data, status){
        let items = data[0]['items'];
        $.each(items, function (i, item) {
            $('#file-select').append($('<option>', {
                value: item,
                text : item
            }));
        });
    });

    $.get("http://127.0.0.1:8000/files", function(data, status){
        $.each(checkItems, function (i, item) {
            let container = $('#check-box-contents');
            let inputs = container.find('input');
            let id = inputs.length + 1;

            $('<input />', { type: 'checkbox', id: 'cb'+id, value: item }).appendTo(container);
            $('<label />', { 'for': 'cb'+id, text: item }).appendTo(container);
        });
    });
});

const getData = () => {
    let selectedFile = $('#file-select').find(":selected").text();
    let columns = [];
    $('#check-box-contents input:checked').each(function() {
        columns.push($(this).attr('value'));
    });

    let request = {
        "fileName" : selectedFile,
        "columns": columns
    }

    $.ajax({
        type: 'GET',
        url: 'http://127.0.0.1:8000/data',
        success : (data) => {
            $('.results-container').show();
            buildTable(data[0])
        }
    })

    const buildTable = (data) => {
        $.each(data , function (index, item) {
            $.each(item, function (i, k) {
                createTableRows(i, k, index);
            });
        });
    }

    const createTableHeadersOld = (headColumns) => {
        let tableHeadElementRows = $('#result-table thead tr');
        console.log('headColumns ', headColumns)
        $.each(headColumns, function (index, columnName) {
            $(tableHeadElementRows).append($('<th>', {
                text : columnName
            }));
        })
    }

    const createTableHeaders = (headColumns) => {
        let tableHeadElementRows = $('#result-table thead tr');
        $(tableHeadElementRows).append($('<th>', {
            text : headColumns.substring(1)
        }));
    }

    const createTableRows = (rowName, rows, index) => {
        if (rowName == 0) {
            createTableHeaders(index)
        }

        let tableElementRows = $('#result-table tbody');

        if($('.tr-' + rowName).length) {
            let tableElementRowData = $('.tr-' + rowName);
            $(tableElementRowData).append(
                $('<td>').text(rows),
            );
        } else {
            var $tr = $(`<tr class=tr-${rowName}>`).append(
                $('<td>').text(rows),
            ).appendTo(tableElementRows);
        }
    }
}


